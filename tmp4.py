# 152개 각 종목의 특정 날짜 종가

from pykrx import stock
import time
from tqdm import tqdm
import pandas as pd


savePath = './raw_data/'

tickers = ['000070', '000080', '000100', '000120', '000240', '000270', '000660', '000670', '000720', '000810',
           '000880', '000990', '001040', '001060', '001120', '001230', '001440', '001450', '001680', '001740',
           '002350', '002790', '003000', '003230', '003240', '003490', '003520', '003850', '004000', '004020',
           '004170', '004370', '004490', '005250', '005380', '005440', '005490', '005830', '005930', '005940',
           '006040', '006260', '006280', '006360', '006400', '006650', '006800', '007070', '007310', '007570',

           '008560', '008770', '008930', '009150', '009240', '009420', '009830', '010060', '010120', '010130',
           '010140', '010620', '010780', '010950', '011070', '011170', '011210', '011780', '012330', '012450',
           '012750', '014680', '014820', '015760', '016360', '017670', '017800', '018260', '018880', '019170',
           '020000', '020150', '021240', '024110', '026960', '028050', '028260', '028670', '029780', '030000',
           '030200', '031430', '032640', '032830', '033780', '034020', '034220', '034730', '035250', '035420',

           '036460', '036570', '039490', '042670', '047040', '047050', '049770', '051600', '051900', '051910',
           '052690', '055550', '057050', '064350', '064960', '066570', '069260', '069620', '069960', '071050',
           '071840', '073240', '078930', '079160', '079550', '081660', '086280', '086790', '088350', '090430',
           '093370', '096770', '097950', '103140', '105560', '105630', '108670', '111770', '112610', '114090',
           '115390', '120110', '128940', '138930', '139480', '161390', '161890', '180640', '185750', '192820',

           '204320', '214320']

tickers = tqdm(tickers)

output = pd.DataFrame(columns=['ticker', 'return'])

# OHLCV api
for i, ticker in enumerate(tickers):
    df = stock.get_market_ohlcv_by_date("20170101", "20201231", ticker)
    time.sleep(1)

    start = df.head(1)
    end = df.tail(1)
    r = ((int(end['종가'])/int(start['종가']))-1)*100

    target = pd.DataFrame([{'ticker':f'A{ticker}', 'return':r}])
    output = pd.concat([output, target])

print(output)
output.to_csv(savePath + 'kospi152_train_r.csv', index=False, encoding='euc-kr')